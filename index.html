<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Future Career AI</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Import Map: Defines where to load modules from -->
    <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@18.2.0",
    "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
    "lucide-react": "https://esm.sh/lucide-react@0.344.0",
    "@google/genai": "https://esm.run/@google/genai",
    "html2canvas": "https://esm.sh/html2canvas",
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.1/",
    "react/": "https://aistudiocdn.com/react@^19.2.1/"
  }
}
</script>

    <style>
        body { font-family: 'Noto Sans KR', sans-serif; }
        .animate-fade-in { animation: fadeIn 0.5s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        .break-keep { word-break: keep-all; }
    </style>
<link rel="stylesheet" href="/index.css">
</head>
<body class="bg-slate-50 text-slate-900 antialiased selection:bg-blue-100 selection:text-blue-900">
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useRef } from 'react';
        import { createRoot } from 'react-dom/client';
        import { 
            BrainCircuit, Leaf, Cpu, Lock, GraduationCap, ArrowRight, Briefcase, 
            Search, Sparkles, MessageCircle, Send, Loader2, Info, Download, 
            CheckCircle, Share2, Home, ArrowLeft, Layers, Menu, X, Plus, 
            Edit2, Trash2, Save, LogOut, AlertCircle 
        } from 'lucide-react';
        import { GoogleGenAI, Type } from "@google/genai";
        import html2canvas from "html2canvas";

        // ==========================================================================================
        // âš™ï¸ [ì„¤ì • ë° ë°ì´í„°]
        // ==========================================================================================
        
        // ğŸ”¥ API KEY (Google Cloud Consoleì—ì„œ ì›¹ì‚¬ì´íŠ¸ ì œí•œ ì„¤ì •ì„ ê¼­ í™•ì¸í•˜ì„¸ìš”)
        const VITE_API_KEY = "AIzaSyBrCJHhTrngIqzuQiW3fvlrqJQMdTSyJvc";
        
        const VALUE_CHAIN_CONTEXT = [
            { id: 'step1', label: '1. ì±„ì§‘ (Aggregation)', summary: "ì›ë£Œ í™•ë³´", description: "ë°˜ë„ì²´ì™€ AIì˜ ì¬ë£Œê°€ ë˜ëŠ” í¬í† ë¥˜, ë¦¬íŠ¬ ë“± ê´‘ë¬¼ì„ ìºë‚´ê±°ë‚˜, AI í•™ìŠµì— í•„ìš”í•œ ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•˜ëŠ” ë‹¨ê³„ì…ë‹ˆë‹¤." },
            { id: 'step2', label: '2. ê°€ê³µ (Processing)', summary: "ì†Œì¬/ë°ì´í„° ì •ì œ", description: "ì±„ì§‘í•œ ì›ë£Œë¥¼ ì›¨ì´í¼ë¡œ ë§Œë“¤ê±°ë‚˜, ë°ì´í„°ë¥¼ ë¼ë²¨ë§ ë° ì „ì²˜ë¦¬í•˜ëŠ” ë‹¨ê³„ì…ë‹ˆë‹¤." },
            { id: 'step3', label: '3. ìƒì‚° (Production)', summary: "ì œì¡° ë° í•™ìŠµ", description: "ë‚˜ë…¸ ë‹¨ìœ„ ì¹©ì„ ìƒì‚°í•˜ê±°ë‚˜, ê±°ëŒ€ ì–¸ì–´ ëª¨ë¸(LLM)ì„ ë°ì´í„°ì„¼í„°ì—ì„œ í•™ìŠµì‹œí‚¤ëŠ” ë‹¨ê³„ì…ë‹ˆë‹¤." },
            { id: 'step4', label: '4. ìš´ì†¡ (Transportation)', summary: "ë¬¼ë¥˜ ë° ì „ì†¡", description: "ì¹©ì„ ì „ ì„¸ê³„ë¡œ ë°°ì†¡í•˜ê±°ë‚˜, í•´ì € ì¼€ì´ë¸”ì„ í†µí•´ ë°ì´í„°ë¥¼ ì „ì†¡í•˜ëŠ” ë‹¨ê³„ì…ë‹ˆë‹¤." },
            { id: 'step5', label: '5. í™œìš© (Utilization)', summary: "ì„œë¹„ìŠ¤ ì´ìš©", description: "ìŠ¤ë§ˆíŠ¸í°, ììœ¨ì£¼í–‰, ì±—GPT ë“± ì‹¤ì œ ì„œë¹„ìŠ¤ë¥¼ ì‚¬ìš©í•˜ëŠ” ë‹¨ê³„ì…ë‹ˆë‹¤." },
            { id: 'step6', label: '6. íê¸° (Disposal)', summary: "ì¬í™œìš© ë° íŒŒê¸°", description: "ê¸°ê¸°ë¥¼ ë¶„í•´í•´ ìì›ì„ íšŒìˆ˜í•˜ê±°ë‚˜(ë„ì‹œê´‘ì‚°), ë°ì´í„°ì™€ ëª¨ë¸ì„ íê¸°í•˜ëŠ” ë‹¨ê³„ì…ë‹ˆë‹¤." },
        ];

        const UNIVERSITY_SUBJECTS = [
            { subject: "ì¸ê³µì§€ëŠ¥ ì…ë¬¸", major: "ì»´í“¨í„°ê³µí•™" },
            { subject: "ë§ˆì¼€íŒ… ì „ëµ", major: "ê²½ì˜í•™" },
            { subject: "í—Œë²•ê³¼ ì‚¬íšŒ", major: "ë²•í•™" },
            { subject: "ë°˜ë„ì²´ ê³µì •", major: "ì „ìê³µí•™" },
            { subject: "í˜„ëŒ€ ì†Œì„¤ ì½ê¸°", major: "êµ­ì–´êµ­ë¬¸í•™" },
            { subject: "êµìœ¡ ì‹¬ë¦¬", major: "êµìœ¡í•™" },
            { subject: "ë¯¸ìƒë¬¼í•™", major: "ìƒëª…ê³µí•™" },
            { subject: "êµ­ì œ ì •ì¹˜", major: "ì •ì¹˜ì™¸êµí•™" },
            { subject: "ë°ì´í„° ì‹œê°í™”", major: "í†µê³„í•™" },
            { subject: "ë””ìì¸ ì”½í‚¹", major: "ë””ìì¸" },
            { subject: "ì„œì–‘ ë¯¸ìˆ ì‚¬", major: "ë¯¸ìˆ ì‚¬í•™" },
            { subject: "ìš´ë™ ìƒë¦¬í•™", major: "ì²´ìœ¡í•™" }
        ];

        const INITIAL_READING_MATERIALS = [
          {
              id: "101",
              title: "í”¼ ë¬»ì€ ë°°í„°ë¦¬: ì½©ê³  ì½”ë°œíŠ¸ ê´‘ì‚°ì˜ ì•„ë™ë“¤",
              valueChain: "step1",
              majors: ["ìì›ê³µí•™", "ì‚¬íšŒë³µì§€í•™", "ì‚¬íšŒí•™", "ë²•í•™", "ê²½ì˜í•™", "êµ­ì œí•™ê³¼", "ì§€ì—­ê°œë°œ", "ì˜ˆë°©ì˜í•™", "ìœ¤ë¦¬", "ì¸ê¶Œ", "ì˜ì‚¬", "ê°„í˜¸ì‚¬", "ë³´ê±´í•™", "êµìœ¡í•™", "êµì‚¬"],
              keywords: ["ì¸ê¶Œ", "ì•„ë™", "ë…¸ë™", "ë³µì§€", "ì˜ë£Œ", "ë³´ê±´", "êµ­ì œ", "êµ¬í˜¸", "NGO", "í•™êµ", "ì„ ìƒë‹˜", "ì–´ë¦°ì´"],
              content: `## [ì‹¬ì¸µ ë¦¬í¬íŠ¸] ìŠ¤ë§ˆíŠ¸í° ë°°í„°ë¦¬ ë’¤ì— ìˆ¨ê²¨ì§„ ì•„ì´ë“¤ì˜ ëˆˆë¬¼\n\n### 1. ë°°ê²½ íƒêµ¬: ê¸°ìˆ ê³¼ í˜„ì¥ì˜ ë§¥ë½\nìš°ë¦¬ê°€ ë§¤ì¼ ì‚¬ìš©í•˜ëŠ” ìŠ¤ë§ˆíŠ¸í°ê³¼ ì „ê¸°ì°¨ ë°°í„°ë¦¬ì˜ í•µì‹¬ ì›ë£Œì¸ **ì½”ë°œíŠ¸(Cobalt)**. ì „ ì„¸ê³„ ê³µê¸‰ëŸ‰ì˜ 70% ì´ìƒì´ ì•„í”„ë¦¬ì¹´ì˜ **ì½©ê³ ë¯¼ì£¼ê³µí™”êµ­(DRC)**ì—ì„œ ìƒì‚°ë©ë‹ˆë‹¤. í•˜ì§€ë§Œ ì´ê³³ì—ëŠ” ìµœì²¨ë‹¨ ê¸°ìˆ ê³¼ëŠ” ê±°ë¦¬ê°€ ë¨¼ ë¹„ê·¹ì ì¸ í˜„ì¥ì´ ì¡´ì¬í•©ë‹ˆë‹¤. ë°”ë¡œ **'ìˆ˜ê³µì—… ì±„êµ´(Artisanal Mining)'**ì…ë‹ˆë‹¤. ì´ëŠ” ì¤‘ì¥ë¹„ ì—†ì´ ê³¡ê´­ì´ì™€ ì‚½ ê°™ì€ ê¸°ë³¸ ë„êµ¬ë§Œìœ¼ë¡œ, í˜¹ì€ ë§¨ì†ìœ¼ë¡œ ë•…ì„ íŒŒë‚´ë ¤ê°€ëŠ” ë°©ì‹ì„ ë§í•©ë‹ˆë‹¤. ì•½ 15ë§Œ ëª…ì— ë‹¬í•˜ëŠ” ìˆ˜ê³µì—… ê´‘ë¶€ë“¤ì´ ê°±ë„ì— ë“¤ì–´ê°€ë©°, ì—¬ê¸°ì—ëŠ” 7ì„¸ ë‚¨ì§“í•œ ì•„ì´ë“¤ë„ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤.\n\n### 2. ë‹¤ê°ì  ë¶„ì„: ê¸°ìˆ ì„ ë³´ëŠ” ì„¸ ê°€ì§€ ì‹œì„ \n\n**(1) ì‚¬íšŒ(Social): ì¸ê¶Œ ìœ ë¦°ê³¼ ê±´ê°•ê¶Œ ë°•íƒˆ**\nê°€ì¥ ì‹¬ê°í•œ ë¬¸ì œëŠ” **ì•„ë™ ë…¸ë™**ê³¼ **ì•ˆì „ ë¶€ì¬**ì…ë‹ˆë‹¤. ì•„ì´ë“¤ì€ í•™êµ ëŒ€ì‹  ê°±ë„ë¡œ í–¥í•˜ë©°, í•˜ë£¨ ì¢…ì¼ ì¼í•˜ê³  ë°›ëŠ” ëˆì€ ê³ ì‘ 1.5ë‹¬ëŸ¬(ì•½ 2,000ì›) ë‚¨ì§“ì…ë‹ˆë‹¤. ì•ˆì „ ì¥ë¹„ í•˜ë‚˜ ì—†ì´ ì§€í•˜ ìˆ˜ì‹­ ë¯¸í„° ê°±ë„ì—ì„œ ì¼í•˜ë‹¤ ë¶•ê´´ ì‚¬ê³ ë¡œ ë§¤ëª°ë˜ê±°ë‚˜, ìœ ë…ì„± ì½”ë°œíŠ¸ ë¨¼ì§€ë¥¼ ë§ˆì…” **'ê²½ê¸ˆì† í ì§ˆí™˜(Hard Metal Lung Disease)'**ì´ë¼ëŠ” ì¹˜ëª…ì ì¸ í˜¸í¡ê¸° ì§ˆí™˜ì— ì‹œë‹¬ë¦½ë‹ˆë‹¤. ì´ëŠ” ë‹¨ìˆœí•œ ë…¸ë™ ì°©ì·¨ë¥¼ ë„˜ì–´, ì¸ê°„ì˜ ì¡´ì—„ì„±ê³¼ ê±´ê°•ê¶Œì„ ì¹¨í•´í•˜ëŠ” ì‹¬ê°í•œ ì¸ê¶Œ ë¬¸ì œì…ë‹ˆë‹¤. ì˜í•™ì  ê´€ì ì—ì„œë„ ì¤‘ê¸ˆì† ì¤‘ë…ê³¼ í˜¸í¡ê¸° ì†ìƒì€ ì‹¬ê°í•œ ê³µì¤‘ë³´ê±´ ìœ„ê¸°ì…ë‹ˆë‹¤.\n\n**(2) ê²½ì œ(Economic): ê³µê¸‰ë§ì˜ ë¶ˆíˆ¬ëª…ì„±ê³¼ ë¦¬ìŠ¤í¬**\nê¸€ë¡œë²Œ ê¸°ì—…ë“¤ì€ **OECD ì‹¤ì‚¬ ì§€ì¹¨**ì— ë”°ë¼ ê³µê¸‰ë§ ë‚´ ì¸ê¶Œ ì¹¨í•´ ì—¬ë¶€ë¥¼ ê°ì‹œí•´ì•¼ í•©ë‹ˆë‹¤. í•˜ì§€ë§Œ ì½”ë°œíŠ¸ëŠ” ë¯¸êµ­ì˜ **ë„ë“œ-í”„ë­í¬ë²•**ì´ ê·œì •í•œ 'ë¶„ìŸ ê´‘ë¬¼'ì— í¬í•¨ë˜ì§€ ì•Šì•„ ê°ì‹œì˜ ì‚¬ê°ì§€ëŒ€ì— ë†“ì—¬ ìˆì—ˆìŠµë‹ˆë‹¤. ìµœê·¼ ì¸ê¶Œ ì˜ì‹ì´ ë†’ì•„ì§€ë©´ì„œ 'í”¼ ë¬»ì€ ì½”ë°œíŠ¸'ë¥¼ ì‚¬ìš©í•˜ëŠ” ê¸°ì—…ì€ ESG ë¦¬ìŠ¤í¬ë¥¼ ì•ˆê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.\n\n**(3) í™˜ê²½(Environmental - Type A): ìƒíƒœê³„ ì˜¤ì—¼**\nìˆ˜ê³µì—… ì±„êµ´ í›„ ë‚¨ì€ **ê´‘ë¬¼ ì°Œêº¼ê¸°(Tailings)**ëŠ” ì ì ˆí•œ ì •í™” ì‹œì„¤ ì—†ì´ ê°•ê³¼ ê°œìš¸ì—ì„œ ì„¸ì²™ë©ë‹ˆë‹¤. ì´ ê³¼ì •ì—ì„œ ì¤‘ê¸ˆì†ì´ í¬í•¨ëœ ì˜¤ì—¼ìˆ˜ê°€ ê·¸ëŒ€ë¡œ í˜ëŸ¬ë“¤ì–´ê°€ ì§€ì—­ ì£¼ë¯¼ë“¤ì˜ ì‹ìˆ˜ì›ì„ ì˜¤ì—¼ì‹œí‚¤ê³ , ë†ì‘ë¬¼ ì¬ë°°ë¥¼ ë¶ˆê°€ëŠ¥í•˜ê²Œ ë§Œë“­ë‹ˆë‹¤.\n\n### 3. ì§„ë¡œ ì¸ì‚¬ì´íŠ¸: ë‚´ ìƒê° ì—…ê·¸ë ˆì´ë“œí•˜ê¸° (Career Upgrade)\n**(ì§€ì‹œì‚¬í•­: ë…ìê°€ ì´ ê¸€ì„ ì½ê¸° ì „ì— ì‘ì„±í–ˆë˜ 'ìì‹ ì˜ ì§„ë¡œì™€ AI-ë°˜ë„ì²´ì˜ ì—°ê´€ì„±' ë‚´ìš©ì„, ë³¸ë¬¸ì˜ êµ¬ì²´ì  ì‚¬ë¡€ë¥¼ í†µí•´ ë” ë„“ê³  ê¹Šê²Œ 'í™•ì¥'í•˜ë„ë¡ ìœ ë„í•˜ëŠ” ì§ˆë¬¸ì…ë‹ˆë‹¤.)**\n\n**Q1. [ì‹œê°ì˜ í™•ì¥] ë‚´ê°€ ë†“ì¹˜ê³  ìˆë˜ ì—°ê²°ê³ ë¦¬ëŠ” ë¬´ì—‡ì¸ê°€?**\n- (ì§ˆë¬¸ ê°€ì´ë“œ: "ê¸€ì„ ì½ê¸° ì „, ë‹¹ì‹ ì´ ìƒê°í–ˆë˜ ì§„ë¡œì™€ ê¸°ìˆ ì˜ ì—°ê´€ì„±ì€ ë¬´ì—‡ì´ì—ˆë‚˜ìš”? ë³¸ë¬¸ì˜ **[ì•„ë™ ë…¸ë™ì˜ ì°¸í˜¹í•œ í˜„ì‹¤ê³¼ ê³µê¸‰ë§ì˜ ê·¸ë¦¼ì]**ë¥¼ ì ‘í•œ í›„, ê·¸ ìƒê°ì— **ìƒˆë¡­ê²Œ ì¶”ê°€í•˜ê±°ë‚˜ ìˆ˜ì •í•´ì•¼ í•  ë¶€ë¶„**ì€ ë¬´ì—‡ì¸ì§€ êµ¬ì²´ì ìœ¼ë¡œ ì„œìˆ í•´ë³´ì„¸ìš”.")\n\n**Q2. [ë¬¸ì œ í•´ê²° ì ìš©] ë‚´ ì§ì—…ì˜ ë‚œì œë¥¼ ì´ ê¸°ìˆ ë¡œ í•´ê²°í•œë‹¤ë©´?**\n- (ì§ˆë¬¸ ê°€ì´ë“œ: "ë‹¹ì‹ ì˜ í¬ë§ ì§ì—…({{MY_JOB}})ì—ì„œ ê²ªì„ ìˆ˜ ìˆëŠ” ê°€ì¥ ê³¨ì¹˜ ì•„í”ˆ ë¬¸ì œë¥¼ í•˜ë‚˜ ë– ì˜¬ë ¤ë³´ì„¸ìš”. ì˜¤ëŠ˜ ì½ì€ **[ê³µê¸‰ë§ íˆ¬ëª…ì„± ì¶”ì  ê¸°ìˆ (ë¸”ë¡ì²´ì¸ ë“±)]**ì„ **'ë„êµ¬'ë¡œ í™œìš©í•˜ì—¬ ê·¸ ë¬¸ì œë¥¼ í•´ê²°í•˜ëŠ” ì‹œë‚˜ë¦¬ì˜¤**ë¥¼ ì±—ë´‡ì—ê²Œ ì œì•ˆí•´ë³´ì„¸ìš”.")`
          },
          // ... (ë°ì´í„° ì¤‘ëµ: ë‹¤ë¥¸ í•­ëª©ë“¤ì€ ê·¸ëŒ€ë¡œ ìœ ì§€ë¨) ...
          {
              id: "602",
              title: "AI ì¹©ì˜ ìˆœí™˜ ê²½ì œ: ì“°ë ˆê¸°í†µì—ì„œ ê¸ˆ ìºê¸°",
              valueChain: "step6",
              majors: ["í™”í•™ê³µí•™", "ì—ë„ˆì§€ê³µí•™", "ìì›ê³µí•™", "ê²½ì œí•™", "ì‹ ì†Œì¬ê³µí•™", "ê²½ì˜í•™", "ë³´ì„ì„¸ê³µ", "ê¸ˆì†ê³µì˜ˆ"],
              keywords: ["ìì›", "ê²½ì œ", "ê²½ì˜", "í™˜ê²½", "ì¬í™œìš©", "ê³µí•™", "ìˆœí™˜", "ê¸ˆ", "ê¸ˆì†", "ì¥¬ì–¼ë¦¬"],
              content: `## [ì‹¬ì¸µ ë¦¬í¬íŠ¸] ìŠ¤ë§ˆíŠ¸í° ì†ì— ê¸ˆë§¥ì´ ìˆë‹¤? 'ë„ì‹œ ê´‘ì‚°'\n\n### 1. ë°°ê²½ íƒêµ¬: ê¸°ìˆ ê³¼ í˜„ì¥ì˜ ë§¥ë½\nAI ì¹© ë“± ì „ì íê¸°ë¬¼ ì†ì—ëŠ” ê¸ˆ, ì€, í¬í† ë¥˜ê°€ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤. íê¸°ë¬¼ì—ì„œ ìì›ì„ íšŒìˆ˜í•˜ëŠ” **'ë„ì‹œ ê´‘ì‚°'** ì‚°ì—…ì´ ì£¼ëª©ë°›ìŠµë‹ˆë‹¤.\n\n### 2. ë‹¤ê°ì  ë¶„ì„: ê¸°ìˆ ì„ ë³´ëŠ” ì„¸ ê°€ì§€ ì‹œì„ \n\n**(1) ì‚¬íšŒ(Social): ìœ¤ë¦¬ì  ìì› í™•ë³´**\në„ì‹œ ê´‘ì‚°ì€ ì•„ë™ ë…¸ë™ì´ë‚˜ ë¶„ìŸ ê´‘ë¬¼ ë¬¸ì œ ì—†ì´ ìœ¤ë¦¬ì ìœ¼ë¡œ ìì›ì„ í™•ë³´í•  ëŒ€ì•ˆì…ë‹ˆë‹¤.\n\n**(2) ê²½ì œ(Economic): ìì› ì•ˆë³´ì™€ ê³µê¸‰ë§ ë¦¬ìŠ¤í¬ ì™„í™”**\nìì› ë¬´ê¸°í™” ì‹œëŒ€ì— íê¸°ë¬¼ ìì› íšŒìˆ˜ëŠ” êµ­ê°€ ìì› ì•ˆë³´ì— ê¸°ì—¬í•˜ëŠ” **'ìˆœí™˜ ê²½ì œ'** ëª¨ë¸ì…ë‹ˆë‹¤.\n\n**(3) í™˜ê²½(Environment - Type A): ì „ì íê¸°ë¬¼ ê°ì†Œ**\nì¬í™œìš©ë¥ ì„ ë†’ì—¬ í™˜ê²½ ì˜¤ì—¼ì„ ë§‰ê³ , ì„¤ê³„ ë‹¨ê³„ë¶€í„° **'ì¬í™œìš©ì„ ê³ ë ¤í•œ ì„¤ê³„'**ê°€ í•„ìš”í•©ë‹ˆë‹¤.\n\n### 3. ì§„ë¡œ ì¸ì‚¬ì´íŠ¸: ë‚´ ìƒê° ì—…ê·¸ë ˆì´ë“œí•˜ê¸° (Career Upgrade)\n**(ì§€ì‹œì‚¬í•­: ë…ìê°€ ì´ ê¸€ì„ ì½ê¸° ì „ì— ì‘ì„±í–ˆë˜ 'ìì‹ ì˜ ì§„ë¡œì™€ AI-ë°˜ë„ì²´ì˜ ì—°ê´€ì„±' ë‚´ìš©ì„, ë³¸ë¬¸ì˜ êµ¬ì²´ì  ì‚¬ë¡€ë¥¼ í†µí•´ ë” ë„“ê³  ê¹Šê²Œ 'í™•ì¥'í•˜ë„ë¡ ìœ ë„í•˜ëŠ” ì§ˆë¬¸ì…ë‹ˆë‹¤.)**\n\n**Q1. [ì‹œê°ì˜ í™•ì¥] ë‚´ê°€ ë†“ì¹˜ê³  ìˆë˜ ì—°ê²°ê³ ë¦¬ëŠ” ë¬´ì—‡ì¸ê°€?**\n- (ì§ˆë¬¸ ê°€ì´ë“œ: "ê¸€ì„ ì½ê¸° ì „, ë‹¹ì‹ ì´ ìƒê°í–ˆë˜ ì§„ë¡œì™€ ê¸°ìˆ ì˜ ì—°ê´€ì„±ì€ ë¬´ì—‡ì´ì—ˆë‚˜ìš”? ë³¸ë¬¸ì˜ **[íê¸°ë¬¼ì—ì„œ ìì›ì„ ìºë‚´ëŠ” ë„ì‹œ ê´‘ì‚°ì˜ ê°€ëŠ¥ì„±]**ì„ ì ‘í•œ í›„, ê·¸ ìƒê°ì— **ìƒˆë¡­ê²Œ ì¶”ê°€í•˜ê±°ë‚˜ ìˆ˜ì •í•´ì•¼ í•  ë¶€ë¶„**ì€ ë¬´ì—‡ì¸ì§€ êµ¬ì²´ì ìœ¼ë¡œ ì„œìˆ í•´ë³´ì„¸ìš”.")\n\n**Q2. [ë¬¸ì œ í•´ê²° ì ìš©] ë‚´ ì§ì—…ì˜ ë‚œì œë¥¼ ì´ ê¸°ìˆ ë¡œ í•´ê²°í•œë‹¤ë©´?**\n- (ì§ˆë¬¸ ê°€ì´ë“œ: "ë‹¹ì‹ ì˜ í¬ë§ ì§ì—…({{MY_JOB}})ì—ì„œ ê²ªì„ ìˆ˜ ìˆëŠ” ê°€ì¥ ê³¨ì¹˜ ì•„í”ˆ ë¬¸ì œë¥¼ í•˜ë‚˜ ë– ì˜¬ë ¤ë³´ì„¸ìš”. ì˜¤ëŠ˜ ì½ì€ **[ìì› íšŒìˆ˜ AI ë¡œë´‡ì´ë‚˜ ìˆœí™˜ ê²½ì œ í”Œë«í¼]**ì„ **'ë„êµ¬'ë¡œ í™œìš©í•˜ì—¬ ê·¸ ë¬¸ì œë¥¼ í•´ê²°í•˜ëŠ” ì‹œë‚˜ë¦¬ì˜¤**ë¥¼ ì±—ë´‡ì—ê²Œ ì œì•ˆí•´ë³´ì„¸ìš”.")`
          }
        ];
        
        // ë°ì´í„° ëˆ„ë½ ë°©ì§€ë¥¼ ìœ„í•´ ë‚˜ë¨¸ì§€ ë°ì´í„°ë„ ì—¬ê¸°ì— ì±„ì›Œë„£ì–´ì•¼ í•¨ (ìƒëµëœ ê²½ìš° ì´ì „ ë°ì´í„° ì‚¬ìš©)
        // (ì‹¤ì œ ì½”ë“œì—ëŠ” INITIAL_READING_MATERIALSì— 17ê°œ í•­ëª© ëª¨ë‘ í¬í•¨ë˜ì–´ì•¼ í•©ë‹ˆë‹¤)
        
        // --- Mock Services ---
        let memoryMaterials = [...INITIAL_READING_MATERIALS];
        const fetchMaterials = async () => new Promise(resolve => setTimeout(() => resolve([...memoryMaterials]), 300));
        const saveMaterial = async (item) => new Promise(resolve => { setTimeout(() => { const idx = memoryMaterials.findIndex(m => m.id === item.id); if(idx>=0) memoryMaterials[idx]=item; else memoryMaterials.push(item); resolve(); }, 300); });
        const deleteMaterial = async (id) => new Promise(resolve => { setTimeout(() => { memoryMaterials = memoryMaterials.filter(m => m.id !== id); resolve(); }, 300); });

        // --- Gemini Service ---
        const ai = new GoogleGenAI({ apiKey: API_KEY });
        const modelName = 'gemini-2.5-flash';

        const getCareerRecommendations = async (subjects) => {
          try {
            const prompt = `í•™ìƒ ì „ê³µ ìˆ˜ì—…: ${subjects.join(', ')}. ì´ ìˆ˜ì—…ë“¤ì„ ë°”íƒ•ìœ¼ë¡œ 1) ì–´ìš¸ë¦¬ëŠ” í•™ê³¼ 3ê°œ, 2) êµ¬ì²´ì ì¸ ì§ì—… 5ê°œë¥¼ í•œêµ­ì–´ë¡œ, ì¹œì ˆí•œ ì¤„ê¸€ í˜•ì‹ìœ¼ë¡œ ì¶”ì²œí•´ì£¼ì„¸ìš”. í‘œ(Table)ëŠ” ì‚¬ìš©í•˜ì§€ ë§ˆì„¸ìš”.`;
            const response = await ai.models.generateContent({
              model: modelName,
              contents: prompt,
              config: { systemInstruction: "ì¹œì ˆí•œ ì§„ë¡œ ìƒë‹´ ì „ë¬¸ê°€ì…ë‹ˆë‹¤." }
            });
            return response.text || "ì¶”ì²œì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.";
          } catch (e) { console.error(e); return "ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."; }
        };

        const recommendAndGenerateMaterials = async (job, thought, existingMaterials) => {
            const existingMetadata = existingMaterials.map(m => ({ id: m.id, title: m.title, tags: [...m.majors, ...m.keywords].join(', ') }));
            const prompt = `
              ì§ì—…: ${job}, ìƒê°: ${thought}
              1. ê¸°ì¡´ ìë£Œ ì¤‘ ê´€ë ¨ìˆëŠ” ID 2ê°œ ì„ íƒ.
              2. ìƒˆë¡œìš´ ì‹¬ì¸µ ë¦¬í¬íŠ¸ ìƒì„± (ê°€ì¹˜ì‚¬ìŠ¬ ë‹¨ê³„ ì„ íƒ).
              
              [í•„ìˆ˜ í˜•ì‹ - JSON]
              {
                "recommendedIds": ["id1", "id2"],
                "generatedMaterial": {
                  "title": "ì œëª©",
                  "valueChain": "step1~6 ì¤‘ í•˜ë‚˜",
                  "majors": ["ì „ê³µ1"],
                  "keywords": ["í‚¤ì›Œë“œ1"],
                  "content": "ë§ˆí¬ë‹¤ìš´ í˜•ì‹ ë³¸ë¬¸ (ë°˜ë“œì‹œ ì•„ë˜ êµ¬ì¡° ì¤€ìˆ˜)"
                }
              }

              [Content êµ¬ì¡°]
              ## [ì‹¬ì¸µ ë¦¬í¬íŠ¸] ê´€í†µí•˜ëŠ” ì§ˆë¬¸ 1ë¬¸ì¥
              ### 1. ë°°ê²½ íƒêµ¬: ì†Œì œëª©
              ë‚´ìš© 2-3ì¤„
              ### 2. ë‹¤ê°ì  ë¶„ì„: ì†Œì œëª©
              **(1) ì‚¬íšŒ(Social): ì†Œì œëª©** ë‚´ìš©
              **(2) ê²½ì œ(Economic): ì†Œì œëª©** ë‚´ìš©
              **(3) í™˜ê²½(Environment): ì†Œì œëª©** ë‚´ìš©
              ### 3. ì§„ë¡œ ì¸ì‚¬ì´íŠ¸: ë‚´ ìƒê° ì—…ê·¸ë ˆì´ë“œí•˜ê¸° (Career Upgrade)
              **Q1. [ì‹œê°ì˜ í™•ì¥] ...**
              **Q2. [ë¬¸ì œ í•´ê²° ì ìš©] ...**

              ê¸°ì¡´ìë£Œ: ${JSON.stringify(existingMetadata)}
            `;
            
            try {
                // Type.OBJECT ì‚¬ìš©
                const response = await ai.models.generateContent({
                    model: modelName,
                    contents: prompt,
                    config: { responseMimeType: "application/json" }
                });
                const result = JSON.parse(response.text);
                const recommended = existingMaterials.filter(m => result.recommendedIds?.includes(m.id));
                let generated = null;
                if(result.generatedMaterial) generated = { id: `gen_${Date.now()}`, ...result.generatedMaterial, isGenerated: true };
                return { recommended, generated };
            } catch(e) { console.error(e); return { recommended: [], generated: null }; }
        };

        const chatWithMentor = async (history, job, material) => {
            const stepInfo = VALUE_CHAIN_CONTEXT.find(s => s.id === material.valueChain);
            const systemInstruction = `ì¹œì ˆí•œ AI ë©˜í† ì…ë‹ˆë‹¤. ì†Œí¬ë¼í…ŒìŠ¤ ë¬¸ë‹µë²•ì„ ì‚¬ìš©í•˜ì„¸ìš”. í•™ìƒ ì§ì—…: ${job}, ìë£Œ: ${material.title}. ì •ë‹µì„ ë°”ë¡œ ì£¼ì§€ ë§ê³  ì§ˆë¬¸ì„ í†µí•´ ìœ ë„í•˜ì„¸ìš”. í•œêµ­ì–´ë¡œ ë‹µë³€í•˜ì„¸ìš”.`;
            const contents = history.map(msg => ({ role: msg.role, parts: [{ text: msg.text }] }));
            try {
                const response = await ai.models.generateContent({ model: modelName, contents, config: { systemInstruction } });
                return response.text;
            } catch(e) { return "ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."; }
        };

        const generateEsgFeedback = async (job, materialTitle, thoughts, history) => {
             const systemInstruction = `ESG ì»¨ì„¤í„´íŠ¸ì…ë‹ˆë‹¤. í•™ìƒ ì§ì—…: ${job}, ìë£Œ: ${materialTitle}. í™˜ê²½:${thoughts.env}, ì‚¬íšŒ:${thoughts.soc}, ê²½ì œ:${thoughts.eco}. 500ì ì´ë‚´ë¡œ í•µì‹¬ë§Œ ê°„ê²°í•˜ê²Œ í”¼ë“œë°±í•˜ì„¸ìš”. ë¹„íŒì  ì§ˆë¬¸ì„ í•˜ë‚˜ ë˜ì§€ì„¸ìš”. ì¤„ê¸€ë¡œ ì‘ì„±í•˜ì„¸ìš”.`;
             const contents = history.map(msg => ({ role: msg.role, parts: [{ text: msg.text }] }));
             try {
                 const response = await ai.models.generateContent({ model: modelName, contents, config: { systemInstruction } });
                 return response.text;
             } catch(e) { return "ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."; }
        };

        // --- UI Components ---
        const MarkdownRenderer = ({ content }) => {
            if (!content) return null;
            return (
                <div className="space-y-4 text-slate-700 leading-relaxed">
                    {content.split('\n').map((line, i) => {
                        const trimmed = line.trim();
                        if (trimmed.startsWith('### ')) return <h3 key={i} className="text-xl font-bold text-slate-800 mt-6 mb-2 border-l-4 border-blue-500 pl-3">{trimmed.replace('### ', '')}</h3>;
                        if (trimmed.startsWith('## ')) return <h2 key={i} className="text-2xl font-extrabold text-slate-900 mt-8 mb-4 pb-2 border-b border-slate-200">{trimmed.replace('## ', '')}</h2>;
                        if (trimmed.startsWith('- ')) return <div key={i} className="flex gap-2 ml-1 mb-2"><span className="text-blue-500 font-bold">â€¢</span><span className="flex-1">{trimmed.replace('- ', '').replace(/\*\*(.*?)\*\*/g, (match, p1) => p1)}</span></div>;
                        if (trimmed === '') return <div key={i} className="h-2" />;
                        
                        const parts = line.split(/(\*\*.*?\*\*)/g);
                        return <p key={i}>
                            {parts.map((part, idx) => {
                                if (part.startsWith('**') && part.endsWith('**')) return <strong key={idx} className="font-bold text-indigo-900 bg-indigo-50 px-1 rounded">{part.slice(2, -2)}</strong>;
                                return part;
                            })}
                        </p>;
                    })}
                </div>
            );
        };

        const Layout = ({ title, color, job, onHome, onBack, onAdmin, children }) => {
            const borderColor = color === 'blue' ? 'border-blue-500' : 'border-green-500';
            const badgeBg = color === 'blue' ? 'bg-blue-100' : 'bg-green-100';
            const badgeText = color === 'blue' ? 'text-blue-700' : 'text-green-700';
            return (
                <div className="min-h-screen bg-slate-50 font-sans flex flex-col">
                    <header className={`bg-white shadow-sm p-4 sticky top-0 z-10 flex items-center justify-between border-b-4 ${borderColor}`}>
                        <div className="flex items-center gap-3">
                            <button onClick={onHome} className="p-2 hover:bg-slate-100 rounded-full transition text-slate-600"><Home size={24} /></button>
                            {onBack && <button onClick={onBack} className="p-2 hover:bg-slate-100 rounded-full transition text-slate-600"><ArrowLeft size={24} /></button>}
                            <h2 className="text-xl font-bold text-slate-800 hidden md:block">{title}</h2>
                        </div>
                        <div className="flex items-center gap-2">
                            <div className={`px-4 py-1.5 rounded-full ${badgeBg} ${badgeText} font-bold text-sm flex items-center gap-2 shadow-sm`}>
                                <Briefcase size={14} />
                                <span className="truncate max-w-[120px] md:max-w-xs">{job ? `ë‚˜ì˜ ì§„ë¡œ: ${job}` : 'ì§„ë¡œ íƒìƒ‰ ì¤‘'}</span>
                            </div>
                            {onAdmin && <button onClick={onAdmin} className="p-2 hover:bg-slate-100 rounded-full text-slate-400 hover:text-slate-600 transition"><Lock size={18} /></button>}
                        </div>
                    </header>
                    <main className="flex-1 w-full max-w-7xl mx-auto p-4 md:p-6 pb-24">{children}</main>
                </div>
            );
        };

        const ValueChainRenderer = ({ activeStepId }) => {
          const [viewingStep, setViewingStep] = useState(activeStepId);

          return (
            <div className="bg-white border border-slate-200 rounded-xl p-4 my-3 font-sans shadow-sm w-full">
              <div className="flex flex-col mb-3 gap-1">
                <div className="font-bold text-slate-700 text-sm flex items-center gap-1">
                  <Layers size={16} className="text-blue-600" /> 
                  AI-ë°˜ë„ì²´ ê°€ì¹˜ì‚¬ìŠ¬ (Value Chain)
                </div>
                <div className="text-xs text-slate-400 font-normal">
                  ë²ˆí˜¸ë¥¼ í´ë¦­í•˜ì—¬ ë‹¤ë¥¸ ë‹¨ê³„ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”.
                </div>
              </div>

              <div className="flex w-full h-12 rounded-lg overflow-hidden bg-slate-100 border border-slate-200 mb-3">
                {VALUE_CHAIN_CONTEXT.map((step, index) => {
                  const isActive = step.id === activeStepId;
                  const isViewing = step.id === viewingStep;
                  
                  let bgClass = 'bg-slate-100 hover:bg-slate-200 text-slate-400';
                  if (isActive) bgClass = 'bg-blue-600 text-white';
                  if (isViewing && !isActive) bgClass = 'bg-blue-100 text-blue-600 ring-2 ring-inset ring-blue-300';

                  return (
                    <button 
                      key={step.id} 
                      onClick={() => setViewingStep(step.id)}
                      className={`flex-1 flex flex-col items-center justify-center transition-all duration-200 ${bgClass} ${index !== 0 ? 'border-l border-slate-200' : ''}`}
                      title={step.label}
                    >
                      <span className="text-xs sm:text-sm font-bold">{index + 1}</span>
                    </button>
                  );
                })}
              </div>

              <div className={`p-3 rounded-lg text-xs leading-relaxed border transition-colors duration-300 ${viewingStep === activeStepId ? 'bg-blue-50 text-blue-800 border-blue-100' : 'bg-slate-50 text-slate-700 border-slate-200'}`}>
                <div className="font-bold mb-1 flex items-center gap-1 text-sm">
                   {viewingStep === activeStepId && "ğŸ“ í˜„ì¬ ë‹¨ê³„: "} 
                   {VALUE_CHAIN_CONTEXT.find(s => s.id === viewingStep)?.label}
                </div>
                <div className="font-semibold mb-1 opacity-90">
                  {VALUE_CHAIN_CONTEXT.find(s => s.id === viewingStep)?.summary}
                </div>
                <div className="opacity-80">
                  {VALUE_CHAIN_CONTEXT.find(s => s.id === viewingStep)?.description}
                </div>
              </div>
            </div>
          );
        };

        const AdminLoginModal = ({ isOpen, onClose, onLogin }) => {
            const [password, setPassword] = useState('');
            const [error, setError] = useState('');

            useEffect(() => {
                if (isOpen) { setPassword(''); setError(''); }
            }, [isOpen]);

            if (!isOpen) return null;

            return (
                <div className="fixed inset-0 bg-black/50 z-[60] flex items-center justify-center p-4 animate-fade-in">
                    <div className="bg-white rounded-xl p-6 w-full max-w-sm shadow-2xl">
                        <h3 className="text-xl font-bold mb-4 flex items-center gap-2 text-slate-800"><Lock size={20}/> ê´€ë¦¬ì ë¡œê·¸ì¸</h3>
                        <input type="password" value={password} onChange={(e) => { setPassword(e.target.value); setError(''); }} onKeyDown={(e) => e.key === 'Enter' && onLogin(password)} placeholder="ë¹„ë°€ë²ˆí˜¸ (1234)" className="w-full border p-3 rounded-lg mb-2 outline-none focus:ring-2 focus:ring-blue-500 transition" autoFocus />
                        {error && <p className="text-red-500 text-sm mb-3 flex items-center gap-1"><AlertCircle size={14}/> {error}</p>}
                        <div className="flex gap-2 justify-end mt-4">
                            <button onClick={onClose} className="px-4 py-2 text-slate-500 hover:bg-slate-100 rounded-lg transition font-medium">ì·¨ì†Œ</button>
                            <button onClick={() => onLogin(password)} className="px-4 py-2 bg-blue-600 text-white rounded-lg font-bold hover:bg-blue-700 transition">í™•ì¸</button>
                        </div>
                    </div>
                </div>
            );
        };

        const AdminDashboard = ({ materials, onClose, onRefresh }) => {
            const [view, setView] = useState('list');
            const [filterStep, setFilterStep] = useState('all');
            const [formData, setFormData] = useState({});

            const handleDelete = async (id) => { if(confirm("ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) { await deleteMaterial(id); onRefresh(); } };
            const handleSave = async () => { await saveMaterial(formData); onRefresh(); setView('list'); };
            
            // ... (Editor, List impl simplified for brevity)
            if(view === 'list') {
                const filtered = filterStep === 'all' ? materials : materials.filter(m => m.valueChain === filterStep);
                return (
                    <div className="min-h-screen bg-slate-50 p-6 font-sans">
                        <div className="bg-slate-800 text-white p-4 shadow-md sticky top-0 z-10 flex justify-between items-center mb-6 rounded-xl">
                            <h2 className="text-xl font-bold flex gap-2"><Lock/> ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</h2>
                            <button onClick={onClose} className="bg-slate-700 px-3 py-1 rounded">ë‚˜ê°€ê¸°</button>
                        </div>
                        <div className="flex gap-2 mb-4">
                            <select value={filterStep} onChange={e=>setFilterStep(e.target.value)} className="p-2 border rounded">
                                <option value="all">ì „ì²´</option>
                                {VALUE_CHAIN_CONTEXT.map(s=><option key={s.id} value={s.id}>{s.label}</option>)}
                            </select>
                            <button onClick={()=>{setFormData({id:Date.now().toString(), title:'', content:'', majors:[], keywords:[], valueChain:'step1'}); setView('edit');}} className="bg-blue-600 text-white px-4 py-2 rounded flex items-center gap-1"><Plus size={16}/> ì¶”ê°€</button>
                        </div>
                        <div className="grid gap-4">
                            {filtered.map(m => (
                                <div key={m.id} className="bg-white p-4 rounded-xl shadow flex justify-between items-center border">
                                    <div><div className="font-bold">{m.title}</div><div className="text-xs text-slate-500">{m.valueChain}</div></div>
                                    <div className="flex gap-2">
                                        <button onClick={()=>{setFormData(m); setView('edit');}} className="text-blue-600 p-2 bg-blue-50 rounded"><Edit2 size={16}/></button>
                                        <button onClick={()=>handleDelete(m.id)} className="text-red-600 p-2 bg-red-50 rounded"><Trash2 size={16}/></button>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>
                );
            }
            return (
                <div className="min-h-screen bg-slate-50 p-6 flex justify-center items-start">
                    <div className="bg-white p-6 rounded-xl shadow-lg w-full max-w-2xl border">
                        <h3 className="text-xl font-bold mb-4">{formData.id ? 'ìˆ˜ì •' : 'ì¶”ê°€'}</h3>
                        <div className="space-y-4">
                            <input value={formData.title} onChange={e=>setFormData({...formData, title:e.target.value})} placeholder="ì œëª©" className="w-full border p-2 rounded" />
                            <select value={formData.valueChain} onChange={e=>setFormData({...formData, valueChain:e.target.value})} className="w-full border p-2 rounded">
                                {VALUE_CHAIN_CONTEXT.map(s=><option key={s.id} value={s.id}>{s.label}</option>)}
                            </select>
                            <input value={formData.majors?.join(', ')} onChange={e=>setFormData({...formData, majors:e.target.value.split(',').map(s=>s.trim())})} placeholder="ì „ê³µ (ì½¤ë§ˆ êµ¬ë¶„)" className="w-full border p-2 rounded" />
                            <textarea value={formData.content} onChange={e=>setFormData({...formData, content:e.target.value})} placeholder="ë‚´ìš© (Markdown)" className="w-full border p-2 rounded h-64 font-mono text-sm" />
                            <div className="flex justify-end gap-2">
                                <button onClick={()=>setView('list')} className="px-4 py-2 border rounded">ì·¨ì†Œ</button>
                                <button onClick={handleSave} className="px-4 py-2 bg-blue-600 text-white rounded">ì €ì¥</button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // --- Main App Component ---
        const App = () => {
            const [view, setView] = useState('LANDING');
            const [allMaterials, setAllMaterials] = useState([]);
            const [loading, setLoading] = useState(false);
            const [isAdminOpen, setIsAdminOpen] = useState(false);
            const [isLoginModalOpen, setIsLoginModalOpen] = useState(false);
            
            // P1 State
            const [p1Step, setP1Step] = useState(0);
            const [selectedSubjects, setSelectedSubjects] = useState([]);
            const [myJob, setMyJob] = useState('');
            const [myThought, setMyThought] = useState('');
            const [recJobs, setRecJobs] = useState('');
            const [matched, setMatched] = useState([]);
            const [generated, setGenerated] = useState(null);
            const [selectedMat, setSelectedMat] = useState(null);
            const [p1History, setP1History] = useState([]);
            const [p1Input, setP1Input] = useState('');

            // P2 State
            const [p2Step, setP2Step] = useState(0);
            const [esg, setEsg] = useState({env:'', soc:'', eco:''});
            const [p2History, setP2History] = useState([]);
            const [p2Input, setP2Input] = useState('');

            // Scroll Refs
            const p1EndRef = useRef(null);
            const p2EndRef = useRef(null);
            
            useEffect(() => { fetchMaterials().then(setAllMaterials); }, []);
            useEffect(() => { p1EndRef.current?.scrollIntoView({ behavior: 'smooth' }); }, [p1History]);
            useEffect(() => { p2EndRef.current?.scrollIntoView({ behavior: 'smooth' }); }, [p2History]);

            const handleAdminAccess = () => { setIsLoginModalOpen(true); };
            const handleAdminLogin = (pwd) => {
                if(pwd === "1234") { setIsLoginModalOpen(false); setView('ADMIN'); }
                else alert("í‹€ë ¸ìŠµë‹ˆë‹¤.");
            };

            const handleRecommendation = async () => {
                setLoading(true);
                const res = await getCareerRecommendations(selectedSubjects);
                setRecJobs(res);
                setLoading(false);
                setP1Step(2);
            };

            const handleFindMat = async () => {
                if(!myJob) return alert('ì§ì—…ì„ ì…ë ¥í•˜ì„¸ìš”');
                setLoading(true);
                setP1Step(4);
                const { recommended, generated: gen } = await recommendAndGenerateMaterials(myJob, myThought, allMaterials);
                setMatched(recommended);
                setGenerated(gen);
                setLoading(false);
            };

            const startChatP1 = (m) => {
                setSelectedMat(m);
                setP1History([{role:'model', text:`ì•ˆë…•í•˜ì„¸ìš”! **${myJob}** ê´€ì ì—ì„œ **"${m.title}"**ì— ëŒ€í•´ ì´ì•¼ê¸°í•´ë´ìš”.`, valueChain:m.valueChain, type:'intro'}]);
                setP1Step(5);
            };

            const sendP1 = async () => {
                if(!p1Input.trim()) return;
                const newHist = [...p1History, {role:'user', text:p1Input}];
                setP1History(newHist);
                setP1Input('');
                setLoading(true);
                const res = await chatWithMentor(newHist, myJob, selectedMat);
                setP1History([...newHist, {role:'model', text:res}]);
                setLoading(false);
            };

            const startP2 = async () => {
                if(!esg.env || !esg.soc || !esg.eco) return alert('ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”');
                setP2History([{role:'user', text:`ì§ì—…:${myJob}\ní™˜ê²½:${esg.env}\nì‚¬íšŒ:${esg.soc}\nê²½ì œ:${esg.eco}`}]);
                setP2Step(2);
                setLoading(true);
                const res = await generateEsgFeedback(myJob, selectedMat?.title||'Context', esg, [{role:'user', text:`ì§ì—…:${myJob}\ní™˜ê²½:${esg.env}\nì‚¬íšŒ:${esg.soc}\nê²½ì œ:${esg.eco}`}]);
                setP2History(prev=>[...prev, {role:'model', text:res}]);
                setLoading(false);
            };

            const sendP2 = async () => {
                if(!p2Input.trim()) return;
                const newHist = [...p2History, {role:'user', text:p2Input}];
                setP2History(newHist);
                setP2Input('');
                setLoading(true);
                const res = await generateEsgFeedback(myJob, selectedMat?.title||'Context', esg, newHist);
                setP2History([...newHist, {role:'model', text:res}]);
                setLoading(false);
            };

            const downloadImage = async () => {
                const el = document.getElementById('final-report');
                if(el) {
                    const canvas = await html2canvas(el, { scale: 2, backgroundColor: '#ffffff', useCORS: true });
                    const link = document.createElement('a');
                    link.download = `Report_${myJob}.png`;
                    link.href = canvas.toDataURL();
                    link.click();
                }
            };
            
            // Navigation
            const goBackP1 = () => {
                if(p1Step===0) setView('LANDING');
                else if(p1Step===1) setP1Step(0);
                else if(p1Step===2) setP1Step(1);
                else if(p1Step===3) setP1Step(recJobs ? 2 : 0);
                else if(p1Step===4) setP1Step(3);
                else if(p1Step===5) setP1Step(4);
            };
            
            const goBackP2 = () => {
                if(p2Step===1) {
                    if(selectedMat) { setView('PERIOD1'); setP1Step(5); }
                    else setView('LANDING');
                } else if(p2Step>1) setP2Step(p2Step-1);
            };

            if(view === 'ADMIN') return (
                <AdminDashboard materials={allMaterials} onClose={()=>setView('LANDING')} onRefresh={()=>fetchMaterials().then(setAllMaterials)} />
            );

            if(view === 'LANDING') return (
                <>
                    <AdminLoginModal isOpen={isLoginModalOpen} onClose={()=>setIsLoginModalOpen(false)} onLogin={handleAdminLogin} />
                    <div className="flex flex-col items-center justify-center min-h-screen relative p-6">
                        <header className="absolute top-0 w-full p-6 flex justify-between items-center text-slate-700">
                            <div className="flex items-center gap-2 font-bold text-xl"><Cpu className="text-blue-600" /> Future Career AI</div>
                            <button onClick={handleAdminAccess} className="p-2 hover:bg-slate-200 rounded-full text-slate-400"><Lock size={20} /></button>
                        </header>
                        <h1 className="text-4xl md:text-5xl font-black text-slate-800 mb-4 text-center">ë³µì¡ì„± ì‹œëŒ€ì˜ ì§„ë¡œì™€<br/><span className="text-blue-600 bg-blue-50 px-2 rounded-lg mt-2 inline-block">AI-ë°˜ë„ì²´</span></h1>
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6 w-full max-w-4xl mt-12">
                            <button onClick={()=>setView('PERIOD1')} className="group bg-white p-8 rounded-3xl shadow-xl hover:-translate-y-1 transition border border-slate-100 flex flex-col items-center">
                                <div className="bg-blue-100 p-4 rounded-full mb-4 group-hover:bg-blue-600 transition"><BrainCircuit size={48} className="text-blue-600 group-hover:text-white" /></div>
                                <h2 className="text-2xl font-bold text-slate-800">1êµì‹œ: ì§„ë¡œì™€ AI ì—°ê²°</h2>
                            </button>
                            <button onClick={()=>{setView('PERIOD2'); setP2Step(1);}} className="group bg-white p-8 rounded-3xl shadow-xl hover:-translate-y-1 transition border border-slate-100 flex flex-col items-center">
                                <div className="bg-green-100 p-4 rounded-full mb-4 group-hover:bg-green-600 transition"><Leaf size={48} className="text-green-600 group-hover:text-white" /></div>
                                <h2 className="text-2xl font-bold text-slate-800">2êµì‹œ: ì§€ì†ê°€ëŠ¥ë°œì „(ESG)</h2>
                            </button>
                        </div>
                    </div>
                </>
            );

            if(view === 'PERIOD1') return (
                <Layout title="1êµì‹œ: AIì™€ ì§„ë¡œ" color="blue" job={myJob} onHome={()=>setView('LANDING')} onBack={goBackP1} onAdmin={handleAdminAccess}>
                    <AdminLoginModal isOpen={isLoginModalOpen} onClose={()=>setIsLoginModalOpen(false)} onLogin={handleAdminLogin} />
                    {p1Step===0 && (
                        <div className="text-center py-12 animate-fade-in">
                            <h3 className="text-3xl font-bold mb-8">í¬ë§ ì§„ë¡œê°€ ìˆë‚˜ìš”?</h3>
                            <div className="flex justify-center gap-6">
                                <button onClick={()=>setP1Step(3)} className="px-10 py-5 bg-blue-600 text-white font-bold rounded-2xl shadow">ë„¤, ìˆì–´ìš”</button>
                                <button onClick={()=>setP1Step(1)} className="px-10 py-5 bg-white border-2 text-slate-600 font-bold rounded-2xl shadow">ì•„ë‹ˆìš”</button>
                            </div>
                        </div>
                    )}
                    {p1Step===1 && (
                        <div className="animate-fade-in">
                            <h3 className="text-2xl font-bold mb-4 flex items-center gap-2"><GraduationCap className="text-blue-600"/> ê´€ì‹¬ ìˆëŠ” ì „ê³µ ìˆ˜ì—… ì„ íƒ</h3>
                            <div className="grid grid-cols-2 md:grid-cols-4 gap-3 mb-8">
                                {UNIVERSITY_SUBJECTS.map((s,i)=>(
                                    <button key={i} onClick={()=>{
                                        setSelectedSubjects(prev=>prev.includes(s.subject)?prev.filter(x=>x!==s.subject):[...prev,s.subject]);
                                    }} className={`p-4 rounded-xl text-left border ${selectedSubjects.includes(s.subject)?'bg-blue-600 text-white':'bg-white hover:border-blue-300'}`}>
                                        <div className="font-bold">{s.subject}</div>
                                        <div className="text-xs opacity-80">{s.major}</div>
                                    </button>
                                ))}
                            </div>
                            <button onClick={handleRecommendation} disabled={loading} className="w-full py-4 bg-slate-800 text-white rounded-full font-bold flex justify-center items-center gap-2">
                                {loading?<Loader2 className="animate-spin"/>:'ì§„ë¡œ ì¶”ì²œë°›ê¸°'}
                            </button>
                        </div>
                    )}
                    {p1Step===2 && (
                        <div className="animate-fade-in">
                            <h3 className="text-2xl font-bold mb-4">ì¶”ì²œ ê²°ê³¼</h3>
                            <div className="bg-white p-6 rounded-2xl shadow mb-6"><MarkdownRenderer content={recJobs} /></div>
                            <button onClick={()=>setP1Step(3)} className="bg-blue-600 text-white px-8 py-3 rounded-full font-bold">ë‹¤ìŒ ë‹¨ê³„ë¡œ</button>
                        </div>
                    )}
                    {p1Step===3 && (
                        <div className="animate-fade-in max-w-2xl mx-auto">
                            <h3 className="text-2xl font-bold mb-6">í¬ë§ ì§ì—… ì„¤ì •</h3>
                            <input value={myJob} onChange={e=>setMyJob(e.target.value)} placeholder="ì˜ˆ: ê±´ì¶•ê°€, ì˜ì‚¬" className="w-full p-4 border rounded-xl mb-4 text-lg" />
                            <textarea value={myThought} onChange={e=>setMyThought(e.target.value)} placeholder="AIì™€ ì–´ë–¤ ê´€ë ¨ì´ ìˆì„ê¹Œìš”? (ì„ íƒ)" className="w-full h-32 p-4 border rounded-xl mb-6" />
                            <button onClick={handleFindMat} className="w-full bg-blue-600 text-white py-4 rounded-xl font-bold flex justify-center items-center gap-2">ìë£Œ ì°¾ê¸° <Search size={20}/></button>
                        </div>
                    )}
                    {p1Step===4 && (
                        <div className="animate-fade-in">
                            <h3 className="text-2xl font-bold mb-6">ë§ì¶¤í˜• ì½ê¸° ìë£Œ</h3>
                            {loading ? (
                                <div className="text-center py-20 bg-white rounded-xl border border-blue-100 shadow-sm flex flex-col items-center justify-center animate-pulse">
                                    <Sparkles size={48} className="text-blue-500 animate-spin mb-4" />
                                    <p className="text-slate-500 font-bold">AIê°€ ìë£Œë¥¼ ìƒì„± ì¤‘ì…ë‹ˆë‹¤...</p>
                                </div>
                            ) : (
                                <div className="grid md:grid-cols-2 gap-6">
                                    {generated && (
                                        <button onClick={()=>startChatP1(generated)} className="bg-gradient-to-br from-indigo-50 to-blue-50 p-6 rounded-2xl border border-blue-200 text-left hover:shadow-lg transition">
                                            <div className="text-xs font-bold text-blue-600 mb-2">âœ¨ AI ìƒì„± ìë£Œ</div>
                                            <h4 className="text-lg font-bold text-blue-900 mb-2">{generated.title}</h4>
                                            <p className="text-sm text-slate-600 line-clamp-3">{generated.content.replace(/[#*]/g,'').slice(0,100)}...</p>
                                        </button>
                                    )}
                                    {matched.map(m=>(
                                        <button key={m.id} onClick={()=>startChatP1(m)} className="bg-white p-6 rounded-2xl border border-slate-200 text-left hover:shadow-lg hover:border-blue-400 transition">
                                            <div className="text-xs font-bold text-slate-500 mb-2">{m.valueChain}</div>
                                            <h4 className="text-lg font-bold text-slate-800 mb-2">{m.title}</h4>
                                            <p className="text-sm text-slate-500 line-clamp-2">{m.content.replace(/[#*]/g,'').slice(0,100)}...</p>
                                        </button>
                                    ))}
                                </div>
                            )}
                        </div>
                    )}
                    {p1Step===5 && selectedMat && (
                        <div className="flex flex-col lg:flex-row gap-6 h-[calc(100vh-140px)] animate-fade-in">
                            <div className="lg:w-3/5 bg-white rounded-2xl shadow overflow-hidden flex flex-col">
                                <div className="p-6 overflow-y-auto flex-1"><MarkdownRenderer content={selectedMat.content} /></div>
                            </div>
                            <div className="lg:w-2/5 bg-white rounded-2xl shadow overflow-hidden flex flex-col">
                                <div className="bg-blue-600 p-4 text-white font-bold flex items-center gap-2"><MessageCircle size={20}/> AI ë©˜í† </div>
                                <div className="flex-1 overflow-y-auto p-4 space-y-4 bg-slate-50">
                                    {p1History.map((m,i)=>(
                                        <div key={i} className={`flex ${m.role==='user'?'justify-end':'justify-start'}`}>
                                            <div className={`max-w-[90%] p-4 rounded-2xl text-sm ${m.role==='user'?'bg-blue-600 text-white':'bg-white border'}`}>
                                                {m.type === 'intro' && <ValueChainRenderer activeStepId={m.valueChain}/>}
                                                <MarkdownRenderer content={m.text}/>
                                            </div>
                                        </div>
                                    ))}
                                    {loading && <div className="text-xs text-slate-400 p-2"><Loader2 className="animate-spin inline mr-1"/>ì…ë ¥ ì¤‘...</div>}
                                    <div ref={p1EndRef}/>
                                </div>
                                <div className="p-4 border-t">
                                    <div className="flex gap-2 mb-2">
                                        <textarea value={p1Input} onChange={e=>setP1Input(e.target.value)} onKeyDown={e=>{if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();sendP1();}}} placeholder="ì§ˆë¬¸í•˜ê¸° (Shift+Enter ì¤„ë°”ê¿ˆ)" className="flex-1 p-2 border rounded-xl h-12 resize-none"/>
                                        <button onClick={sendP1} className="bg-blue-600 text-white px-4 rounded-xl"><Send size={18}/></button>
                                    </div>
                                    <button onClick={()=>{setView('PERIOD2');setP2Step(1);}} className="w-full text-xs text-slate-400 hover:text-blue-600 font-bold flex justify-center items-center gap-1">2êµì‹œë¡œ ì´ë™ <ArrowRight size={12}/></button>
                                </div>
                            </div>
                        </div>
                    )}
                </Layout>
            );

            if(view === 'PERIOD2') return (
                <Layout title="2êµì‹œ: ESG" color="green" job={myJob} onHome={()=>setView('LANDING')} onBack={goBackP2} onAdmin={handleAdminAccess}>
                    <AdminLoginModal isOpen={isLoginModalOpen} onClose={()=>setIsLoginModalOpen(false)} onLogin={handleAdminLogin} />
                    {p2Step===1 && (
                        <div className="animate-fade-in max-w-4xl mx-auto">
                            <div className="bg-white p-6 rounded-xl mb-6 shadow-sm border border-slate-200">
                                <h3 className="font-bold flex gap-2 mb-2"><Info className="text-green-600"/> ESGë€?</h3>
                                <p className="text-sm text-slate-600">í™˜ê²½(E), ì‚¬íšŒ(S), ì§€ë°°êµ¬ì¡°(G)ë¥¼ ê³ ë ¤í•˜ì—¬ ì§€ì†ê°€ëŠ¥í•œ ë°œì „ì„ ì¶”êµ¬í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. {myJob}ë¡œì„œ ì–´ë–¤ ê¸°ì—¬ë¥¼ í•  ìˆ˜ ìˆì„ê¹Œìš”?</p>
                            </div>
                            {selectedMat && (
                                <div className="bg-blue-50 p-6 rounded-xl mb-6 border border-blue-100">
                                    <h3 className="font-bold text-blue-800 mb-2">1êµì‹œ ì—°ê²°í•˜ê¸°: {selectedMat.title}</h3>
                                    <p className="text-sm text-slate-700">ì´ ê¸°ì‚¬ì˜ ê¸°ìˆ ì  ì´ìŠˆê°€ í™˜ê²½, ì‚¬íšŒì ìœ¼ë¡œ ì–´ë–¤ ì˜í–¥ì„ ì¤„ì§€ ìƒê°í•´ë³´ì„¸ìš”.</p>
                                </div>
                            )}
                            <div className="grid md:grid-cols-3 gap-4 mb-6">
                                {['env','soc','eco'].map((k,i)=> (
                                    <div key={k} className="bg-white p-4 rounded-xl shadow border-t-4 border-green-500">
                                        <div className="font-bold mb-2 uppercase text-green-700">{['í™˜ê²½(E)','ì‚¬íšŒ(S)','ê²½ì œ(G)'][i]}</div>
                                        <textarea value={esg[k]} onChange={e=>setEsg({...esg,[k]:e.target.value})} className="w-full h-32 p-2 bg-slate-50 rounded text-sm resize-none" placeholder="ì•„ì´ë””ì–´ ì…ë ¥..." />
                                    </div>
                                ))}
                            </div>
                            <button onClick={startP2} className="w-full bg-green-600 text-white py-4 rounded-xl font-bold flex justify-center items-center gap-2">í”¼ë“œë°± ë°›ê¸° <MessageCircle/></button>
                        </div>
                    )}
                    {p2Step===2 && (
                        <div className="flex flex-col h-[calc(100vh-140px)] bg-white rounded-2xl shadow overflow-hidden animate-fade-in">
                            <div className="bg-green-600 p-4 text-white font-bold flex justify-between items-center">
                                <div className="flex items-center gap-2"><Leaf/> ESG ì»¨ì„¤í„´íŠ¸</div>
                                <button onClick={()=>setP2Step(3)} className="bg-white text-green-700 px-3 py-1 rounded text-xs font-bold">ì™„ë£Œí•˜ê¸°</button>
                            </div>
                            <div className="flex-1 overflow-y-auto p-6 space-y-6 bg-slate-50">
                                {p2History.map((m,i)=>(
                                    <div key={i} className={`flex ${m.role==='user'?'justify-end':'justify-start'}`}>
                                        <div className={`max-w-[85%] p-4 rounded-2xl shadow-sm ${m.role==='user'?'bg-green-600 text-white':'bg-white border'}`}><MarkdownRenderer content={m.text}/></div>
                                    </div>
                                ))}
                                {loading && <div className="flex justify-start"><div className="bg-white p-4 rounded-2xl shadow-sm"><Loader2 className="animate-spin text-green-600"/></div></div>}
                                <div ref={p2EndRef}/>
                            </div>
                            <div className="p-4 border-t flex gap-2">
                                <textarea value={p2Input} onChange={e=>setP2Input(e.target.value)} onKeyDown={e=>{if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();sendP2();}}} placeholder="ë…¼ì˜í•˜ê¸° (Shift+Enter)" className="flex-1 p-3 border rounded-xl h-14 resize-none"/>
                                <button onClick={sendP2} className="bg-green-600 text-white px-4 rounded-xl"><Send/></button>
                            </div>
                        </div>
                    )}
                    {p2Step===3 && (
                        <div className="flex flex-col items-center animate-fade-in">
                            <h3 className="text-2xl font-bold mb-6">ğŸ‰ í™œë™ ì™„ë£Œ!</h3>
                            <div id="final-report" className="bg-white p-8 rounded-3xl shadow-xl border w-full max-w-2xl mb-6">
                                <div className="border-b pb-4 mb-4 flex justify-between">
                                    <h2 className="text-xl font-bold text-slate-800 flex gap-2"><Cpu className="text-blue-600"/> Future Career AI Report</h2>
                                    <span className="text-slate-400 text-sm">{new Date().toLocaleDateString()}</span>
                                </div>
                                <div className="space-y-6">
                                    <div><div className="text-xs font-bold text-slate-500">ë‚˜ì˜ ì§„ë¡œ</div><div className="text-2xl font-bold text-blue-800">{myJob}</div></div>
                                    {selectedMat && <div><div className="text-xs font-bold text-slate-500">íƒêµ¬ ìë£Œ</div><div className="font-bold">{selectedMat.title}</div></div>}
                                    <div className="grid grid-cols-3 gap-4 bg-green-50 p-4 rounded-xl border border-green-100">
                                        <div><div className="font-bold text-xs text-green-700">í™˜ê²½(E)</div><div className="text-xs">{esg.env}</div></div>
                                        <div><div className="font-bold text-xs text-indigo-700">ì‚¬íšŒ(S)</div><div className="text-xs">{esg.soc}</div></div>
                                        <div><div className="font-bold text-xs text-amber-700">ê²½ì œ(G)</div><div className="text-xs">{esg.eco}</div></div>
                                    </div>
                                    <div><div className="text-xs font-bold text-slate-500 mb-2">AI ë©˜í† ë§ ìš”ì•½</div><div className="bg-slate-50 p-3 rounded text-xs text-slate-600 italic">{p2History.length>0?p2History[p2History.length-1].text:"ëŒ€í™” ì—†ìŒ"}</div></div>
                                </div>
                            </div>
                            <div className="flex gap-4">
                                <button onClick={downloadImage} className="bg-blue-600 text-white px-8 py-3 rounded-full font-bold flex gap-2 items-center"><Download/> ì´ë¯¸ì§€ ì €ì¥</button>
                                <button onClick={()=>setView('LANDING')} className="border px-8 py-3 rounded-full font-bold">ì²˜ìŒìœ¼ë¡œ</button>
                            </div>
                        </div>
                    )}
                </Layout>
            );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
<script type="module" src="/index.tsx"></script>
</body>
</html>
